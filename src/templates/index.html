<!DOCTYPE html>
<html>
<head>
    <title>Docker31 Data Validation and Anomalies Detection Tool</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!--Basic bootstrap styling-->
    <style>
        .container { max-width: 960px; margin-top: 2rem; }
        #results { margin-top: 2rem; }
        .invalid { color: red; }
        .valid { color: green; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-4">Docker31 Data Validation Tool</h1>
        
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Upload CSV File</h5>
                <form id="uploadForm" class="mb-3">
                    <div class="mb-3">
                        <input type="file" class="form-control" id="csvFile" accept=".csv" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Upload and Preview</button>
                </form>
            </div>
        </div>
        <!--Preview section-->
        <div id="preview" class="mt-4" style="display: none;">
            <h3>Data Preview</h3>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead id="previewHeader"></thead>
                    <tbody id="previewBody"></tbody>
                </table>
            </div>
            <button id="validateBtn" class="btn btn-success mt-3">Validate Data</button>
        </div>
        <!--Data validation section-->
        <div id="results" style="display: none;">
            <h3>Validation Results</h3>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <!--TODO: for later, check the structure with the main app logic-->
                            <th>Row</th>
                            <th>Age Valid</th>
                            <th>Weight Valid</th>
                            <th>Height Valid</th>
                            <th>BMI</th>
                            <th>BMI Valid</th>
                        </tr>
                    </thead>
                    <tbody id="resultsBody"></tbody>
                </table>
            </div>
        </div>
    </div>
    <!--Front-end basic JS logic-->
    <script>
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData();
            const fileInput = document.getElementById('csvFile');
            formData.append('file', fileInput.files[0]);

            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                
                if (response.ok) {
                    showPreview(data.preview);
                } else {
                    alert(data.error);
                }
            } catch (error) {
                alert('Error uploading file');
            }
        });

        function showPreview(data) {
            if (data.length === 0) return;
            
            const preview = document.getElementById('preview');
            const header = document.getElementById('previewHeader');
            const body = document.getElementById('previewBody');
            
            // Create header
            header.innerHTML = `<tr>${Object.keys(data[0]).map(key => `<th>${key}</th>`).join('')}</tr>`;
            
            // Create body
            body.innerHTML = data.map(row => 
                `<tr>${Object.values(row).map(value => `<td>${value}</td>`).join('')}</tr>`
            ).join('');
            
            preview.style.display = 'block';
        }

        document.getElementById('validateBtn').addEventListener('click', async () => {
            try {
                const response = await fetch('/validate', {
                    method: 'POST'
                });
                const results = await response.json();
                
                if (response.ok) {
                    showResults(results);
                } else {
                    alert(results.error);
                }
            } catch (error) {
                alert('Error validating data');
            }
        });
    </script>
</body>
</html>